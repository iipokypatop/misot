<?php
/** @var array $post */
/** @var \Aot\Sviaz\Sequence[] $raw_sequences */

$COLSPAN = count(\Aot\RussianMorphology\ChastiRechi\MorphologyRegistry::getClasses());

$MEMBER_COUNT = 0;
if (isset($raw_sequences)) {
    foreach ($raw_sequences as $index => $raw_sequence) {
        foreach ($raw_sequence as $member) {
            ++$MEMBER_COUNT;
        }
        break;
    }
}

?>

<? require $imports['InputText']['view'] ?>

<? /* <table border="1">
    <caption>Выделение объектов</caption>
    <tr>
        <td>словоформа</td>
        <td>мама</td>
        <td>мыла</td>
        <td>мыла</td>
        <td>раму</td>
    </tr>
    <tr>
        <td>н.ф.</td>
        <td>мама</td>
        <td>мыть</td>
        <td>мыло</td>
        <td>рама</td>
    </tr>
    <tr>
        <td>морф. признаки</td>
        <td>сущ: нариц; одуш</td>
        <td>гл; соверш</td>
        <td>сущ; неодущ</td>
        <td>сущ; неодущ</td>
    </tr>
</table>
*/ ?>
<br/>
<style>

</style>
<table border="1" style="border-spacing: 0;border: 0.1pt;" id="sequence_table">
    <caption style="text-align:left">Составление последовательностей</caption>
    <thead>
    <? if (isset($raw_sequences)) foreach ($raw_sequences as $index => $raw_sequence) : ?>
        <tr>
            <th></th>
            <? foreach ($raw_sequence as $member) : ?>
                <? if (!$member instanceof \Aot\Sviaz\SequenceMember\Word\Base) continue; ?>
                <? $slovo = $member->getSlovo() ?>
                <?= str_repeat('<th>' . $slovo->getText() . '</th>', count(\Aot\RussianMorphology\ChastiRechi\MorphologyRegistry::getClasses())) ?>
            <? endforeach; ?>

        </tr>
        <? break ?>
    <? endforeach; ?>


    <? if (isset($raw_sequences)) foreach ($raw_sequences as $index => $raw_sequence) : ?>
        <tr>
            <th><?= '-' ?></th>
            <? foreach ($raw_sequence as $member) : ?>
                <? if (!$member instanceof \Aot\Sviaz\SequenceMember\Word\Base) continue; ?>
                <? $slovo = $member->getSlovo() ?>
                <? require __DIR__ . '/table/HeadRow.phtml' ?>
            <? endforeach; ?>
        </tr>
        <? break; ?>
    <? endforeach; ?>
    </thead>

    <tbody>
    <? $footerData = [] ?>
    <? if (isset($raw_sequences)) foreach ($raw_sequences as $raw_sequence_index => $raw_sequence) : ?>
        <tr>

            <td><?= $raw_sequence_index ?></td>
            <? foreach ($raw_sequence as $member_index => $member) : ?>

                <? if (!$member instanceof \Aot\Sviaz\SequenceMember\Word\Base) continue; ?>
                <? $slovo = $member->getSlovo() ?>
                <? require __DIR__ . '/table/Row.phtml' ?>

                <? foreach ($slovo->getDeadRows() as $i => $boolean) {
                    if (isset($footerData[$member_index][$i]) && $footerData[$member_index][$i] === true) {
                        continue;
                    }
                    $footerData[$member_index][$i] = $boolean;
                }
                ?>
            <? endforeach; ?>
        </tr>
    <? endforeach; ?>


    </tbody>
    <tfoot>
    <tr>
        <td>-</td>
        <? foreach ($footerData as $word) : ?>
            <? foreach ($word as $morphology) : ?>
                <td><?= intval($morphology) ?></td>
            <? endforeach ?>
        <? endforeach ?>
    </tr>
    </tfoot>
</table>

<? ?>
<?// require __DIR__ . '/Rules/view.phtml' ?>


<script>
    var mergeForms1 = function mergeForms() {
        $("form[name='form[text_for_parse]']")
            .find("input, textarea, select")
            .attr('form', 'form[rule_options]');

        $("form[name='form[rules_form]']")
            .find("input, textarea, select")
            .attr('form', 'form[rule_options]');

        return true;
    }

</script>

<style>
    .class-dead {
        display: none;
    }
</style>
<form method="post" id="form[rule_options]" action="index.php?area=rule&action=ShowRules" name="form[rule_options]"
      onsubmit="return mergeForms1()">

    <table>
        <caption>Данные по тексту</caption>
        <tr>
            <td>Количество слов</td>
            <td><?= $MEMBER_COUNT ?></td>
        </tr>
        <tr>
            <td>Количество связей</td>
            <td><?= $MEMBER_COUNT - 1 ?></td>
        </tr>
        <tr>
            <td>σ +-</td>
            <td>
                <input type="number" name="form[rule_options][sigma]"
                       value="<?= $post['form']['rule_options']['sigma'] ?>"/>
            </td>
        </tr>
        <tr>
            <td></td>
            <td></td>
        </tr>
    </table>
    <input type="hidden" value="ok" name="form[rule_options][submit]">
    <button>ok</button>
</form>

<script>

    $('#sequence_table').find('tfoot tr td').each(function (index) {
        $(this).hide();
        if (index === 0) return;
        if ($(this).html() === '1') {
            $('#sequence_table').find('thead tr').each(function(){
                $($(this).find('th').get()[index]).hide();
            });
            $('#sequence_table').find('tbody tr').each(function(){
                $($(this).find('td').get()[index]).hide();
            });
        }
    })

</script>

